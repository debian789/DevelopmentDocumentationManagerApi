#!/usr/bin/env node
const debug = require('debug')('express-structure')
const app = require('server/app')()
const winston = require('winston')
const UserModel = require('server/models/UserSchema')
winston.remove(winston.transports.Console)
winston.add(winston.transports.Console, {'timestamp':true})

const userGetter = UserModel.authenticate()

/* Configures Authentication */
const passport = require('passport')
const auth = require("server/config/auth")
auth.init(passport, userGetter, {token_secret: "xxx"})

/* Configure mails */
const mails = require('server/config/mails')
const smtpTransporterConfig =  {
  host: "mailtrap.io",
  port: 2525,
  auth: {
    user: "ef0b7164ac711c",
    pass: "e8b9b3a44fb388"
  }
}


mails.init(smtpTransporterConfig, {
    static_context: {baseuri: "http://localhost/"}
})

app.set('port', process.env.PORT || 3000)

const server = app.listen(app.get('port'), function() {
  debug('Express server listening on port ' + server.address().port);
})
